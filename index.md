## The Motive

In the future, i want to monitor my home network with Wazuh and Suricata working together and setup all that on something like a Raspberry pi 4 and I want an easy way to see the alerts that are generated by Wazuh.

I could use the Wazuh integrations that are ready, like [Slack](https://documentation.wazuh.com/current/proof-of-concept-guide/poc-integrate-slack.html), but Discord is an App that I use daily and is perfect to use as an example on how to build a custom integration with Wazuh.

It's possible to create a custom-integration to send alerts to practically any place that has a webhook or any other form of receiving data via POST requests. Like Microsoft Teams, for example.

### The Ambient

I'm assuming that you already have Wazuh instaled and working. I'm working with a "All in one" installation in my kali vm, you can follow with any Linux distribution you like. If you are working with Wazuh distribud in clusters, you will have to replicate the entire configuration on all the node managers that you want the integration to work.

### Creating a webhook

The first thing to do is create a discord webhhok on **your** server chat
```markdown
- Open your server settings
- On "Integrations", click on "webhooks" to generate one
- Save the webhook link for now
```

### Creating the integration

cd in to the Wazuh integrations folder.

You should see the default integrations scritps. 
```markdown
cd /var/ossec/integrations 
```
![](/docs/assets/images/01.png)

As you can see, that are two slack scritps, one is in bash and the other in python, the reason for that is that the bash one will work like a launcher for the python script.

Copy both of them and name it to **custom-discord**

- all custom integrations scripts names need to start with **custom-**
```markdown
cp slack custom-discord
cp slack.py custom-discord.py
```

The **Slack's** scripts were made by the Wazuh team to integrate with Slack via webhook, we can modify them to work with Discord webhook instead. Practically the only modification needed for that to work is going to be the in the **slack.py** **generate_msg()** function.

Before we talk code, i think it's good to understand how a integration is triggered and how you can control what types of alerts will trigger it.

Open the configuration file the Wazuh manager **ossec.conf** 
```markdown
vim /var/ossec/etc/ossec.conf
```

This block of xml is what activates the integration, you will need to insert this on the configuration file of the Wazug manager, **ossec.conf**. You can insert in any place you like, just be careful to not put in the middle of another block.
```markdown
  <integration>
    <name>custom-discord</name>
    <hook_url>https://discord.com/api/webhooks/hook</hook_url>
    <level>7</level>
    <alert_format>json</alert_format>
  </integration>
``` 
![](/docs/assets/images/02.png)

- The tag **name** in the line 354 is where we define the name of the script that will launch the python script.
- The tag **hook** is where you will need to place your webhook url.
- In the line 357 i can control what will trigger the integration, in my case is any Wazuh alert that is equal or greater than 07.

You can use the following options to trigger the alert:
```markdown
<group>suricata,sysmon</group> Only the rules of the group suricata and sysmon will trigger the integration.
<level>12</level> Only rules greate or equal to 12 will trigger.
<rule_id>1299,1300</rule_id> Only this rules will trigger.
```

```
```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [Basic writing and formatting syntax](https://docs.github.com/en/github/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/egn-egn/egn-egn.github.io/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and weâ€™ll help you sort it out.
